---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import ListingCard from '../../components/ListingCard.astro';

const servers = await getCollection('servers');

// Group by first category
const categories = new Map<string, typeof servers>();
for (const server of servers) {
  const cat = server.data.category[0] || 'other';
  if (!categories.has(cat)) categories.set(cat, []);
  categories.get(cat)!.push(server);
}

const recommended = servers.filter(s => s.data.verdict === 'recommended');
---

<Base
  title="MCP Servers â€” Hand-Curated Directory"
  description="Find the best MCP servers for Claude Desktop, Cursor, Claude Code, and more. Honest reviews, compatibility testing, and paste-ready configs."
>
  <div class="container" style="padding-top: 2rem; padding-bottom: 3rem;">
    <h1>MCP Servers</h1>
    <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
      Hand-curated directory of MCP servers that actually work.
    </p>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">
      Every server installed, tested in real clients, reviewed with honest pros and cons.
      {servers.length} servers reviewed. {recommended.length} recommended.
    </p>

    <div style="margin-bottom: 2rem;">
      <h2>Browse by Category</h2>
      <div class="listing-grid" style="margin-top: 0.75rem;">
        <a href="/mcp/best-for-databases/" class="listing-card"><h3 class="card-name">ğŸ—„ï¸ Databases</h3><p class="card-desc">Postgres, MySQL, MongoDB, SQLite, Redis, and more</p></a>
        <a href="/mcp/best-for-devops/" class="listing-card"><h3 class="card-name">ğŸ”§ DevOps</h3><p class="card-desc">GitHub, GitLab, Docker, Jira, Linear, Sentry</p></a>
        <a href="/mcp/best-for-web-scraping/" class="listing-card"><h3 class="card-name">ğŸŒ Web Scraping</h3><p class="card-desc">Firecrawl, Playwright, Browserbase, Fetch</p></a>
        <a href="/mcp/best-for-productivity/" class="listing-card"><h3 class="card-name">ğŸ’¬ Productivity</h3><p class="card-desc">Slack, Notion, Google Drive, Obsidian</p></a>
        <a href="/mcp/best-for-cloud/" class="listing-card"><h3 class="card-name">â˜ï¸ Cloud</h3><p class="card-desc">AWS, Azure, Cloudflare, Terraform, Vercel</p></a>
        <a href="/mcp/best-for-search/" class="listing-card"><h3 class="card-name">ğŸ” Search</h3><p class="card-desc">Brave, Exa, Tavily, Perplexity, Context7</p></a>
        <a href="/mcp/best-for-local-tools/" class="listing-card"><h3 class="card-name">ğŸ“ Local Tools</h3><p class="card-desc">Filesystem, Desktop Commander, Memory</p></a>
        <a href="/mcp/best-for-coding/" class="listing-card"><h3 class="card-name">ğŸ¤– Coding</h3><p class="card-desc">shadcn/ui, Grafana, Stripe, Postman</p></a>
      </div>
    </div>

    <h2><a href="/mcp/servers/">All Servers ({servers.length})</a></h2>

    {[...categories.entries()].map(([cat, catServers]) => (
      <div style="margin-top: 2rem;">
        <h3 style="text-transform: capitalize;">{cat.replace(/-/g, ' ')} ({catServers.length})</h3>
        <div class="listing-grid" style="margin-top: 0.75rem;">
          {catServers.map(server => (
            <ListingCard
              slug={server.id}
              name={server.data.name}
              description={server.data.description}
              verdict={server.data.verdict}
              language={server.data.language}
              setup_difficulty={server.data.setup_difficulty}
              category={server.data.category}
            />
          ))}
        </div>
      </div>
    ))}
  </div>
</Base>
